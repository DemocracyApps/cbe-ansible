---

  - name: Add the latest ansible repository
    action: apt_repository repo='ppa:ansible/ansible' state=present

  - name: update apt cache
    apt: update_cache=yes upgrade=yes

  - name: install git, curl, python, ansible, nodejs, npm, bower and gulp
    apt: name={{ item }} state=present
    with_items:
      - git-core
      - curl
      - python-psycopg2
      - ansible
      - nodejs
      - npm

  - name: Create alias /usr/bin/node -> /usr/bin/nodejs ... Grr
    file: src=/usr/bin/nodejs dest=/usr/bin/node owner=root group=root state=link

  - name: install bower
    npm: name=bower global=yes

  - name: install gulp
    npm: name=gulp global=yes

  - name: Create swap file
    command:  fallocate -l {{ swap_size }} /swapfile
    when: ansible_swaptotal_mb < 1

  - name: Format the file for swap
    command: mkswap /swapfile

  - name: Change swapfile permissions
    file: path=/swapfile owner=root group=root mode=0600

  - name: Add the file to the system as a swap file
    command: swapon /swapfile
    when: ansible_swaptotal_mb < 1

  - name: Add an entry to the fstab
    mount: name=none src=/swapfile fstype=swap opts=sw passno=0 dump=0 state=present



